/**
 * RD Search
 * @param {object} options
 * @param {string|Element} options.output - search result output element
 * @param {string|Element} [options.input] - search input element
 * @param {string} [options.filter] - search files filtration
 * @param {string} [options.handler] - search request handler file
 * @param {string} [options.template] - search result markup template
 * @param {string} [options.mode] - 'live', 'submit'
 * @param {number} [options.minStrLength] - minimum live search string length for searching
 * @constructor
 */
function RDSearch(e){if(!e.output)throw new Error("output is required parameter for RDSearch");for(var t in RDSearch.defaults)this[t]="undefined"!=typeof e[t]?e[t]:RDSearch.defaults[t];"string"==typeof this.form&&(this.form=document.querySelector(this.form)),"string"==typeof this.output&&(this.output=document.querySelector(this.output)),this.input=this.form.querySelector('input[name="s"]'),this.form.RDSearch=this,location.search&&this.output&&this.getResult(location.search),this.form&&this.addHandlers()}RDSearch.defaults={handler:"bat/rd-search.php",filter:"*.html",template:'<h5 class="search-title"><a target="_top" href="#{href}" class="search-link">#{title}</a></h5>\n		<p>...#{token}...</p>\n		<p class="match"><em>Terms matched: #{count} - URL: #{href}</em></p>',form:null,input:null,output:null,mode:null,liveResults:5,minStrLength:3},RDSearch.prototype.addHandlers=function(){var e=this;switch(this.mode){case"live":var t;this.input.addEventListener("focus",function(){e.input.value.trim().length>=e.minStrLength&&(clearTimeout(t),e.output.classList.add("rd-search-show"))}),this.input.addEventListener("blur",function(){t=setTimeout(function(){e.output.classList.remove("rd-search-show")},1500)}),this.output.addEventListener("mousemove",function(){clearTimeout(t),e.output.classList.add("rd-search-show")}),this.output.addEventListener("mouseleave",function(){t=setTimeout(function(){e.output.classList.remove("rd-search-show")},1500)}),this.input.addEventListener("input",function(){e.input.value.trim().length>=e.minStrLength?(e.output.classList.add("rd-search-show"),e.getResult({s:e.input.value})):e.output.classList.remove("rd-search-show")});break;case"submit":this.form.addEventListener("submit",function(t){t.preventDefault(),e.getResult({s:e.input.value})})}},RDSearch.prototype.getResult=function(e){var t=this;this.output.classList.add("rd-search-loading");var r=new XMLHttpRequest,s=new URLSearchParams(e);s.append("template",this.template),s.append("filter",this.filter),"live"===this.mode&&(s.append("liveSearch",!0),s.append("liveCount",this.liveResults)),r.open("GET",this.handler+"?"+s.toString(),!0),r.onreadystatechange=function(e){4===r.readyState&&200===r.status&&(t.output.innerHTML=r.response,t.output.classList.remove("rd-search-loading"))},r.send()};