'use strict';function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}(function(){function objectTag(data){return Object.prototype.toString.call(data).slice(8,-1)}function merge(source,merged){for(var key in merged){if(objectTag(merged[key])==="Object"){if(_typeof(source[key])!=="object")source[key]={};source[key]=merge(source[key],merged[key])}else{source[key]=merged[key]}}return source}function detectIE(){var ua=window.navigator.userAgent,msie=ua.indexOf("MSIE "),trident=ua.indexOf("Trident/"),edge=ua.indexOf("Edge/");if(msie>0){return parseInt(ua.substring(msie+5,ua.indexOf(".",msie)),10)}if(trident>0){var rv=ua.indexOf("rv:");return parseInt(ua.substring(rv+3,ua.indexOf(".",rv)),10)}if(edge>0){return parseInt(ua.substring(edge+5,ua.indexOf(".",edge)),10)}return false}function defaultErrorHandler(error){console.error("[ZemezCore] error:","\n",error);if(!document.querySelector("#global-error")){var node=document.createElement("div");node.setAttribute("id","global-error");node.setAttribute("style","position: fixed; bottom: 1vh; left: 1vw; z-index: 1000; max-width: 98vw; padding: 10px 15px; border-radius: 4px; font-family: monospace; background: #f2564d; color: white;");node.innerText="There was an error on this page, please try again later.";document.body.appendChild(node)}}function ZemezCore(options){var _this=this;merge(this,ZemezCore.defaults);merge(this,options);var isIE=detectIE();if(isIE!==false&&isIE<12){console.warn("[ZemezCore] detected IE"+isIE+", load polyfills");var script=document.createElement("script");script.src=this.IEPolyfill;document.querySelector("head").appendChild(script);script.addEventListener("load",function(){if(_this.IEHandler instanceof Function)_this.IEHandler.call(_this,isIE);_this.init(options)})}else{this.init(options)}}ZemezCore.defaults={observeDOM:true,firstInit:true,debug:false,IEPolyfill:"https://polyfill.io/v3/polyfill.min.js?features=Array.from%2CCustomEvent%2CNodeList.prototype.forEach%2CObject.assign%2CIntersectionObserver%2CPromise",IEHandler:null,onScriptsReady:null,onStylesReady:null,onError:defaultErrorHandler,onReady:null};ZemezCore.prototype.init=function(){var _this2=this;if(this.firstInit){this.initComponents()}if(this.observeDOM){var observer=new MutationObserver(function(mutationsList){mutationsList.forEach(function(mutation){if(mutation.type==="childList"&&mutation.addedNodes.length){mutation.addedNodes.forEach(function(node){if(node.nodeType===Node.ELEMENT_NODE){_this2.initComponents(node)}})}})});observer.observe(document,{childList:true,subtree:true})}};ZemezCore.prototype.checkComponent=function(name){var _this3=this;return new Promise(function(resolve){var component=_this3.components[name];if(!component||component.state==="absent"){resolve()}else{if(component.state==="ready"){resolve()}else{window.addEventListener("".concat(name,":readyScripts"),resolve)}}})};ZemezCore.prototype.makeAsync=function(params,cb){var inclusions=[];params.forEach(function(path){inclusions.push(cb(path))});return Promise.all(inclusions)};ZemezCore.prototype.makeSync=function(params,cb){var chain=Promise.resolve();params.forEach(function(path){chain=chain.then(cb.bind(null,path))});return chain};ZemezCore.prototype.includeStyles=function(path){return new Promise(function(resolve,reject){if(document.querySelector("link[href=\"".concat(path,"\"]"))){resolve()}else{var link=document.createElement("link");link.setAttribute("rel","stylesheet");link.setAttribute("href",path);link.addEventListener("load",resolve);link.addEventListener("error",reject);document.querySelector("head").appendChild(link)}})};ZemezCore.prototype.includeScript=function(path){return new Promise(function(resolve,reject){var node=document.querySelector("script[src=\"".concat(path,"\"]"));if(node){if(node.getAttribute("data-loaded")==="true"){resolve()}else{node.addEventListener("load",resolve);node.addEventListener("error",reject)}}else{var script=document.createElement("script");script.src=path;script.addEventListener("load",function(){script.setAttribute("data-loaded","true");resolve()});script.addEventListener("error",reject);document.querySelector("head").appendChild(script)}})};ZemezCore.prototype.initComponent=function(component){var stylesState=Promise.resolve(),scriptsState=Promise.resolve();if(this.debug)console.log("%c[".concat(component.name,"] init:"),"color: lightgreen; font-weight: 900;",component.nodes.length);component.state="load";if(component.styles){stylesState=stylesState.then(this.makeAsync.bind(this,component.styles,this.includeStyles)).catch(this.onError)}if(component.script){scriptsState=scriptsState.then(this.makeSync.bind(this,component.script,this.includeScript)).catch(this.onError)}if(component.dependencies){scriptsState=scriptsState.then(this.makeSync.bind(this,component.dependencies,this.checkComponent.bind(this))).catch(this.onError)}if(component.init){scriptsState=scriptsState.then(component.init.bind(this,component.nodes)).catch(this.onError)}stylesState.then(function(){window.dispatchEvent(new CustomEvent("".concat(component.name,":readyStyles")))});scriptsState.then(function(){window.dispatchEvent(new CustomEvent("".concat(component.name,":readyScripts")));component.state="ready"});return{scriptsState:scriptsState,stylesState:stylesState}};ZemezCore.prototype.initComponents=function(node,cb){var _this4=this;var stylesPromises=[],scriptsPromises=[];if(!this.components)throw new Error("components is not defined");var components=this.components;node=node||document;for(var key in components){var component=components[key];component.name=key;component.nodes=Array.from(node.querySelectorAll(component.selector));if(node.constructor.name==="HTMLElement"&&node.matches(component.selector)){component.nodes.unshift(node)}if(component.styles&&!(component.styles instanceof Array)){component.styles=[component.styles]}if(component.script&&!(component.script instanceof Array)){component.script=[component.script]}if(component.dependencies&&!(component.dependencies instanceof Array)){component.dependencies=[component.dependencies]}if(component.nodes.length){component.state="pending"}else{component.state="absent"}}for(var _key in components){var _component=components[_key];if(_component.state==="pending"){var componentPromises=this.initComponent(_component);stylesPromises.push(componentPromises.stylesState);scriptsPromises.push(componentPromises.scriptsState)}}Promise.all([Promise.all(scriptsPromises).then(function(){if(_this4.debug)console.log("%c[components]: scriptsReady","color: orange; font-weight: 900;");if(_this4.onScriptsReady instanceof Function)_this4.onScriptsReady.call(_this4);window.dispatchEvent(new CustomEvent("components:scriptsReady"))}),Promise.all(stylesPromises).then(function(){if(_this4.debug)console.log("%c[components]: stylesReady","color: orange; font-weight: 900;");if(_this4.onStylesReady instanceof Function)_this4.onStylesReady.call(_this4);window.dispatchEvent(new CustomEvent("components:stylesReady"))})]).then(function(){if(_this4.debug)console.log("%c[components]: ready","color: orange; font-weight: 900;");if(cb instanceof Function)cb.call(_this4);if(_this4.onReady instanceof Function)_this4.onReady.call(_this4);window.dispatchEvent(new CustomEvent("components:ready"))})};if(!window.ZemezCore){window.ZemezCore=ZemezCore}}).call();